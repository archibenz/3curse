1. Модель OSI. Общая идея, адресация и данные

Модель OSI делит сетевое взаимодействие на 7 уровней, чтобы описать путь данных от приложения до физических сигналов и обратно. Верхние уровни (7–5: прикладной, представления, сеансовый) работают с данными как с содержимым: обеспечивают интерфейс приложений, форматирование, шифрование и установку/управление логическими соединениями.
Транспортный уровень (4) разбивает данные на сегменты, обеспечивает надежность и использует порты для адресации приложений.
Сетевой уровень (3) добавляет IP-адреса и формирует пакеты для маршрутизации между сетями.
Канальный уровень (2) упаковывает пакеты в кадры, добавляя MAC-адреса для передачи внутри локальной сети.
Физический уровень (1) превращает кадры в поток битов и отвечает за реальные электрические/оптические/радиосигналы. Процесс упаковки сверху вниз называется инкапсуляцией, обратный на приёмной стороне – декапсуляцией.  ￼

⸻

2. Канальный уровень OSI: задачи

Канальный уровень обеспечивает доставку данных между соседними узлами в одной сети. Он упаковывает сетевые пакеты в кадры, добавляя служебные поля.
Использует MAC-адреса для адресной доставки кадров и реализует управление доступом к среде, чтобы уменьшить коллизии.
В кадр включается контрольная сумма (FCS); при несоответствии проверке кадр отбрасывается.

⸻

3. Структура кадра Ethernet

Кадр Ethernet начинается с преамбулы для синхронизации. Далее идут MAC-адрес получателя и отправителя.
Поле EtherType/длина указывает, какой протокол верхнего уровня (IPv4, IPv6, ARP и т.п.) инкапсулирован внутри.
Поле данных содержит полезную нагрузку (обычно IP-пакет); при недостаточном размере добавляется заполнение (padding).
В конце располагается FCS (CRC), по которой принимающая сторона проверяет целостность кадра и при ошибке его отбрасывает.

⸻

4. Сетевой уровень OSI: задачи

Сетевой уровень обеспечивает связь между разными сетями и логическую адресацию (IP).
Он отвечает за выбор маршрута (маршрутизацию) через цепочку роутеров, независимо от технологий нижних уровней.
Единица данных здесь – пакет: в заголовок добавляются IP-адреса источника и назначения, а при необходимости выполняется фрагментация пакета под ограничения MTU.

⸻

5. Структура IP-пакета

IP-пакет состоит из заголовка и данных. В заголовке указываются версия протокола (IPv4/IPv6), IP-адреса отправителя и получателя.
Поле TTL задает «время жизни» пакета: при каждом прохождении маршрутизатора TTL уменьшается, и при нуле пакет уничтожается.
Поле «Протокол» показывает, какой транспортный протокол (TCP/UDP) инкапсулирован внутри.
При фрагментации используются специальные поля идентификатора и смещения, чтобы собрать пакет на стороне получателя.

⸻

6. MAC-адрес: структура и назначение

MAC-адрес – 48-битный физический адрес сетевого интерфейса, используемый на канальном уровне для доставки кадров в пределах локальной сети.
Записывается шестнадцатерично в виде 6 байт (например, 00:1A:2B:3C:4D:5E).
Первые 3 байта – идентификатор производителя (OUI), вторые 3 – уникальный номер устройства.
MAC-адреса используются только внутри сегмента L2: при переходе через маршрутизатор они заменяются MAC-адресами следующего узла.

⸻

7. IPv4-адрес: структура и назначение

IPv4 – 32-битный логический адрес устройства в сети. Записывается в виде четырёх десятичных чисел от 0 до 255 (например, 192.168.0.1).
Адрес делится на часть сети (Network ID) и часть хоста (Host ID); границу определяет маска подсети.
Логическая иерархия IP-адресов позволяет маршрутизировать трафик между огромным количеством устройств.

⸻

8. Маска подсети: структура и назначение

Маска подсети определяет, какая часть IP-адреса относится к сети, а какая – к хосту.
Это 32-битное число с последовательностью единиц слева и нулей справа (например, 255.255.255.0 или /24).
При побитовом AND IP-адреса с маской получается адрес сети. По сравнению вычисленных адресов сетей отправителя и получателя устройство решает, отправлять ли пакет напрямую или через шлюз.

⸻

9. Назначение IP-адреса. DHCP

IP-адрес может задаваться статически (ручной ввод) или динамически.
Статика удобна для серверов и устройств, которым нужен постоянный адрес, но трудозатратна в администрировании.
DHCP автоматически выдает клиентам IP-адрес, маску, шлюз и DNS.
Обмен идет по схеме DORA: Discover → Offer → Request → Acknowledge, при этом адрес выдаётся в аренду на определённый срок.

⸻

10. Шлюз и маршрут по умолчанию

Шлюз по умолчанию – устройство (обычно маршрутизатор), через которое локальная сеть выходит во внешние сети.
Маршрут по умолчанию в таблице маршрутизации указывает: если нет более точного маршрута, отправлять пакеты на этот шлюз.
Шлюз может быть задан статически или получен автоматически по DHCP. В таблицах маршрутизации маршрут по умолчанию обозначается как сеть 0.0.0.0/0.

⸻

11. Коммутатор и его служебные таблицы

Коммутатор работает на канальном уровне и передает кадры адресно, а не на все порты.
Он формирует таблицу MAC-адресов (CAM-таблицу), где хранит соответствие «порт → MAC-адрес», обучаясь на проходящем трафике.
При известном MAC-адресе получателя кадр отправляется на конкретный порт (unicast), при неизвестном – рассылается на все порты (flooding). Записи в таблице имеют время жизни и удаляются при неактивности.

⸻

12. Маршрутизатор и таблица маршрутизации

Маршрутизатор работает на сетевом уровне и соединяет разные подсети, принимая решения по IP-адресам.
Таблица маршрутизации содержит записи: сеть назначения, маска, следующий хоп (шлюз) и выходной интерфейс, а также метрику маршрута.
Маршруты могут задаваться статически администратором или формироваться динамически протоколами маршрутизации.

⸻

13. Классическая трёхуровневая архитектура корпоративных сетей
	1.	Уровень доступа (Access)
Подключение конечных устройств (ПК, IP-телефоны, точки Wi-Fi). Коммутаторы L2, VLAN, базовая безопасность портов.
	2.	Уровень распределения (Distribution)
Агрегирует трафик с уровня доступа, выполняет маршрутизацию между VLAN, применяет ACL и политики безопасности. Является границей между L2 и L3.
	3.	Уровень ядра (Core)
Высокоскоростная магистраль между сегментами и внешними сетями. Главный акцент на скорости и отказоустойчивости, без лишней «логики».

⸻

14. Двухуровневая архитектура (свернутое ядро)

Используется в небольших и средних сетях.
Уровень доступа выполняет всё те же функции: подключение клиентов, VLAN, PoE.
Свернутое ядро объединяет задачи ядра и распределения: маршрутизация между VLAN, применение политик, подключение к WAN/Интернету. Реализуется мощными L3-коммутаторами.

⸻

15. Инкапсуляция 802.1Q и типы интерфейсов

802.1Q добавляет в заголовок Ethernet-кадра 4-байтовый тег с VLAN ID, что позволяет вести трафик нескольких VLAN по одному физическому каналу.

Типы портов:
	•	Access – подключение конечных устройств; теги внутри коммутатора есть, но на порт к клиенту кадры уходят без тегов.
	•	Trunk – передача трафика нескольких VLAN между сетевыми устройствами; теги сохраняются.
Также существует Native VLAN: её трафик на транке передается без тега.

⸻

16. ARP-шторм и методы борьбы

ARP-шторм – это ситуация, когда широковещательные ARP-запросы начинают бесконечно циркулировать по сети, перегружая каналы и устройства.
Частая причина – петли в топологии при отсутствии защитных протоколов: коммутаторы размножают широковещательные кадры, создавая лавину трафика.
Для защиты применяют:
	•	STP/RSTP для логического разрыва петель.
	•	Storm Control для ограничения доли широковещательного трафика.
	•	Dynamic ARP Inspection для проверки корректности ARP-пакетов и защиты от подмены.

⸻

17. STP: назначение и работа

STP предотвращает логические петли в сети с избыточными связями между коммутаторами.
Протокол выбирает корневой коммутатор (Root Bridge) с минимальным Bridge ID.
Затем для каждого коммутатора и сегмента определяется лучший путь к корню: соответствующие порты становятся Root/Designated и работают в режиме передачи.
Избыточные порты блокируются. При отказе активного канала STP пересчитывает топологию и активирует резервные пути.

⸻

18. Статическая маршрутизация

При статической маршрутизации все пути задаются вручную администратором.
Каждая запись указывает сеть назначения, маску и шлюз/интерфейс. Роутер просто сверяет IP-адрес назначения с таблицей и отправляет пакет по найденному совпадению.
Плюсы: простота, отсутствие служебного трафика, высокий приоритет.
Минусы: отсутствие автоматической адаптации – при отказе канала маршрут не меняется без вмешательства человека.

⸻

19. Динамическая маршрутизация на примере OSPF

Динамическая маршрутизация позволяет маршрутизаторам автоматически обмениваться данными о топологии сети и перестраивать маршруты при изменениях.
OSPF относится к протоколам состояния канала (Link-State): каждый маршрутизатор рассылает LSA-сообщения о своих соединениях, формируя общую базу топологии (LSDB).
На основе этой карты запускается алгоритм Дейкстры (SPF), выбирающий кратчайшие пути.
Метрика OSPF – «стоимость», зависящая от скорости интерфейса: более быстрый канал имеет меньшую стоимость и предпочтителен.

⸻

20. FHRP на примере VRRP

Протоколы FHRP обеспечивают отказоустойчивость шлюза по умолчанию.
VRRP объединяет несколько маршрутизаторов в виртуальный роутер с общими виртуальными IP и MAC-адресами, которые указываются у клиентов.
Один маршрутизатор работает как Master и пересылает трафик, остальные – Backup, контролируют его состояние по служебным сообщениям.
При отказе Master один из Backup принимает его роль, сохраняя тот же виртуальный адрес, поэтому клиенты не замечают переключения.

⸻

21. NAT: типы адресов и принцип работы

NAT трансформирует внутренние частные IP-адреса в публичные при выходе в Интернет, решая проблему нехватки IPv4 и скрывая внутреннюю сеть.
Частные адреса (например, 192.168.x.x) не маршрутизируются в Интернете; публичные выдаются провайдером.
При PAT (наиболее распространённый вариант) маршрутизатор подменяет внутренний IP и порт источника на свой внешний адрес и уникальный порт, записывая соответствие в таблицу NAT.
Ответы из Интернета по этим портам возвращаются на конкретные внутренние хосты по этой таблице.

⸻

22. Агрегирование интерфейсов и LACP

Агрегирование интерфейсов объединяет несколько физических линий в один логический канал (LAG) для увеличения пропускной способности и отказоустойчивости.
LACP автоматически согласует параметры каналов и проверяет, что порты действительно соединяют нужные устройства, тем самым снижая риск петель и ошибок конфигурации.
Распределение трафика происходит по потокам: на основе хеша от MAC/IP-адресов выбирается конкретный физический линк для данного потока.
При обрыве одного линка LACP перераспределяет трафик по оставшимся активным каналам.

⸻