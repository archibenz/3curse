# Cuthill–McKee для структуры разреженной матрицы

Проект реализует переупорядочение индексов разреженной матрицы по трём схемам:

1) Стандартный Cuthill–McKee (CM)
2) Улучшенный Cuthill–McKee (Improved CM, ICM) с псевдопериферийной вершиной (George–Liu)
3) Обратный Cuthill–McKee (RCM) — это обратный порядок ICM

## Сборка и запуск

### Вариант через GHC (без Cabal)

Сборка:

```bash
ghc -i./src -i./app app/Main.hs -o cuthill-mckee-hs
```

Запуск:

```bash
./cuthill-mckee-hs --input sample/matrix.coo --format coo --algorithm all
```

### Вариант через Cabal

```bash
cabal build
```

Запуск:

```bash
cabal run cuthill-mckee-hs -- --input sample/matrix.coo --format coo --algorithm all
```

Дополнительные флаги:
- `--show-matrix-before-after` — вывести структуру ненулей до и после перестановки (COO без значений).
- `--show-positions` — вывести таблицу позиций `p(i) = pos(i)`.
- `--0based` — печать индексов в 0-based (по умолчанию 1-based).

## Формат входных данных

Поддерживаются два формата матрицы.

### COO

```
n nnz
i j value
i j value
...
```

- Индексация: 1..n.
- Элементы с `value = 0` игнорируются.
- Петли `i == j` допускаются, но не влияют на смежность.
- Если матрица несимметрична, используется симметризованная структура:
  связь между `i` и `j` есть, если `A(i,j) != 0` или `A(j,i) != 0`.

### Dense

```
n
row1 (n чисел)
row2 (n чисел)
...
```

- Нули считаются отсутствием связи, ненули — наличием.
- Симметризация структуры выполняется аналогично COO.

## Описание схем и tie-break правил

Общий принцип: строим граф смежности по структуре ненулей (симметризованной).

- При обходе BFS соседи добавляются в очередь по возрастанию степени вершины `deg(·)`,
  при равенстве — по номеру вершины.
- Если структура несвязная, после завершения компоненты выбирается новая стартовая
  вершина среди непосещённых с минимальной степенью (tie: минимальный индекс).

### CM
- Старт: вершина минимальной степени среди непосещённых.
- BFS по правилам сортировки соседей.

### ICM (Improved CM)
- Старт: псевдопериферийная вершина внутри текущей компоненты.
- Псевдопериферия выбирается по George–Liu:
  1. Берём вершину минимальной степени `s0`.
  2. Строим уровни BFS от `s0`.
  3. В последнем уровне выбираем вершину минимальной степени (tie: минимальный номер) — получаем `s1`.
  4. Повторяем, пока эксцентриситет (число уровней − 1) не увеличивается.

### RCM
- Берётся список вершин ICM и разворачивается.

## Пример

```bash
cabal run cuthill-mckee-hs -- --input sample/matrix.coo --format coo --algorithm all
```

Пример вывода:

```
CM: ...
BW_CM: 3
ICM: ...
BW_ICM: 2
RCM: ...
BW_RCM: 2
```

Ожидаемые значения BW для `sample/matrix.coo`:
- BW_CM = 3
- BW_ICM = 2
- BW_RCM = 2
